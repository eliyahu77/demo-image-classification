# Copyright 2020 Iguazio
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#
kind: job
metadata:
  name: file-utils
  tag: ''
  hash: a273164fa6b5515e03d74b6031b248f578b29f99
  project: ''
  categories: []
spec:
  command: ''
  args: []
  image: mlrun/mlrun:0.4.6
  env:
  - name: V3IO_API
    value: ''
  - name: V3IO_USERNAME
    value: ''
  - name: V3IO_ACCESS_KEY
    value: ''
  description: ''
  build:
    functionSourceCode: IyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlciBvbiAyMDIwLTAzLTIzIDE0OjM1CgppbXBvcnQgb3MKaW1wb3J0IHppcGZpbGUKaW1wb3J0IGpzb24KZnJvbSB0ZW1wZmlsZSBpbXBvcnQgbWt0ZW1wCmltcG9ydCBwYW5kYXMgYXMgcGQKCgpkZWYgb3Blbl9hcmNoaXZlKGNvbnRleHQsIAogICAgICAgICAgICAgICAgIHRhcmdldF9kaXI9J2NvbnRlbnQnLAogICAgICAgICAgICAgICAgIGFyY2hpdmVfdXJsPScnKToKICAgICIiIk9wZW4gYSBmaWxlL29iamVjdCBhcmNoaXZlIGludG8gYSB0YXJnZXQgZGlyZWN0b3J5IiIiCiAgICAgICAgCiAgICBvcy5tYWtlZGlycyh0YXJnZXRfZGlyLCBleGlzdF9vaz1UcnVlKQogICAgY29udGV4dC5sb2dnZXIuaW5mbygnVmVyaWZpZWQgZGlyZWN0b3JpZXMnKQogICAgCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKCdFeHRyYWN0aW5nIHppcCcpCiAgICB6aXBfcmVmID0gemlwZmlsZS5aaXBGaWxlKGFyY2hpdmVfdXJsLCAncicpCiAgICB6aXBfcmVmLmV4dHJhY3RhbGwodGFyZ2V0X2RpcikKICAgIHppcF9yZWYuY2xvc2UoKQogICAgCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYnZXh0cmFjdGVkIGFyY2hpdmUgdG8ge3RhcmdldF9kaXJ9JykKICAgIGNvbnRleHQubG9nX2FydGlmYWN0KCdjb250ZW50JywgbG9jYWxfcGF0aD10YXJnZXRfZGlyKQoKZGVmIGNhdGVnb3JpZXNfbWFwX2J1aWxkZXIoY29udGV4dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlX2RpciwKICAgICAgICAgICAgICAgICAgICAgICAgICAgZGZfZmlsZW5hbWU9J2ZpbGVfY2F0ZWdvcmllc19kZi5jc3YnLAogICAgICAgICAgICAgICAgICAgICAgICAgICBtYXBfZmlsZW5hbWU9J2NhdGVnb3JpZXNfbWFwLmpzb24nKToKICAgICIiIlJlYWQgbGFiZWxlZCBpbWFnZXMgZnJvbSBhIGRpcmVjdG9yeSBhbmQgY3JlYXRlIGNhdGVnb3J5IG1hcCArIGRmCiAgICAKICAgIGZpbGVuYW1lIGZvcm1hdDogPGNhdGVnb3J5Pi5OTi5qcGciIiIKICAgIAogICAgZmlsZW5hbWVzID0gW2ZpbGUgZm9yIGZpbGUgaW4gb3MubGlzdGRpcihzb3VyY2VfZGlyKSBpZiBmaWxlLmVuZHN3aXRoKCcuanBnJyldCiAgICBjYXRlZ29yaWVzID0gW10KICAgICAgICAKICAgIGZvciBmaWxlbmFtZSBpbiBmaWxlbmFtZXM6CiAgICAgICAgY2F0ZWdvcnkgPSBmaWxlbmFtZS5zcGxpdCgnLicpWzBdCiAgICAgICAgY2F0ZWdvcmllcy5hcHBlbmQoY2F0ZWdvcnkpCgogICAgZGYgPSBwZC5EYXRhRnJhbWUoewogICAgICAgICdmaWxlbmFtZSc6IGZpbGVuYW1lcywKICAgICAgICAnY2F0ZWdvcnknOiBjYXRlZ29yaWVzCiAgICB9KQogICAgZGZbJ2NhdGVnb3J5J10gPSBkZlsnY2F0ZWdvcnknXS5hc3R5cGUoJ3N0cicpCiAgICAKICAgIGNhdGVnb3JpZXMgPSBkZi5jYXRlZ29yeS51bmlxdWUoKQogICAgY2F0ZWdvcmllcyA9IHtpOiBjYXRlZ29yeSBmb3IgaSwgY2F0ZWdvcnkgaW4gZW51bWVyYXRlKGNhdGVnb3JpZXMpfQogICAgd2l0aCBvcGVuKG9zLnBhdGguam9pbihjb250ZXh0LmFydGlmYWN0X3BhdGgsIG1hcF9maWxlbmFtZSksICd3JykgYXMgZjoKICAgICAgICBmLndyaXRlKGpzb24uZHVtcHMoY2F0ZWdvcmllcykpCiAgICAgICAgCiAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGNhdGVnb3JpZXMpCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdCgnY2F0ZWdvcmllc19tYXAnLCBsb2NhbF9wYXRoPW1hcF9maWxlbmFtZSkKICAgIGNvbnRleHQubG9nX2RhdGFzZXQoJ2ZpbGVfY2F0ZWdvcmllcycsIGRmPWRmLCBsb2NhbF9wYXRoPWRmX2ZpbGVuYW1lKQoK
    commands: []
    code_origin: https://github.com/mlrun/demo-image-classification.git#7dc3b995168250544c4a6ab6c0fa615ced943bb4:../src/utils.py
